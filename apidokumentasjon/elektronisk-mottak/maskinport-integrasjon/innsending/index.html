<!DOCTYPE html>
<html lang="nb" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="description" content="Beskrivelser av API innen BRs elektroniske mottak av meldinger">


    
    <title>Innsending av meldinger :: BR dokumentasjon</title>
    
    <link rel="shortcut icon" href="/docs/images/favicon.png" type="image/x-icon" />
    <link href="/docs/css/nucleus.css" rel="stylesheet">
    <link href="/docs/css/font-awesome.min.css" rel="stylesheet">
    <link href="/docs/css/hybrid.css" rel="stylesheet">
    <link href="/docs/css/featherlight.min.css" rel="stylesheet">
    <link href="/docs/css/horsey.css" rel="stylesheet">
    
    <link href="/docs/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/docs/css/bootstrap.min.css">
    <script src="/docs/js/jquery-2.x.min.js"></script>
    <style>
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    
<link href="/docs/css/altinn.css" rel="stylesheet">






  </head>
  <body class="" data-url="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/innsending/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
       
	<p><a href="/docs" title="BR docs"><img src="/docs/images/brreg_logo_hvit.png" alt="BR" /> docs</a></p>
 


    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Søk...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script src="/docs/js/lunr.min.js"></script>
<script src="/docs/js/horsey.js"></script>
<script>
    var baseurl = "https:\/\/brreg.github.io\/docs\/";
</script>
<script src="/docs/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
        
        
          
          


 
  
    
    <li data-nav-id="/docs/generelt/" class="dd-item 
        
        
        parent
        ">
      <a href="/docs/generelt/">
        <span>Generelt</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/om-dokumentasjonen/" class="dd-item
     
      ">
        <a href="/docs/generelt/om-dokumentasjonen/">
        <span>Om dokumentasjonen</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/kontakt-oss/" class="dd-item
     
      ">
        <a href="/docs/generelt/kontakt-oss/">
        <span>Kontakt oss</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/eksternt-testmiljo/" class="dd-item
     
      ">
        <a href="/docs/generelt/eksternt-testmiljo/">
        <span>Eksternt testmiljø</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/tilgangsstyring/" class="dd-item
     
      ">
        <a href="/docs/generelt/tilgangsstyring/">
        <span>Tilgangsstyring</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/" class="dd-item 
        parent
        
        parent
        ">
      <a href="/docs/apidokumentasjon/">
        <span>API-dokumentasjon</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/" class="dd-item 
        parent
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/">
        <span>Elektronisk mottak</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/altinn-integrasjon/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/altinn-integrasjon/">
        <span>Integrasjon via Altinn</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/" class="dd-item 
        parent
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/">
        <span>Integrasjon via Maskinporten</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/innsending/" class="dd-item 
        parent
        active
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/innsending/">
        <span>Innsending av meldinger</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/uthenting/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/uthenting/">
        <span>Uthenting av meldinger</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/enhetsregisteret/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/enhetsregisteret/">
        <span>Enhetsregisteret</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/losoreregisteret/">
        <span>Løsøreregisteret</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/">
        <span>Intet til utlegg/utleggstrekk (ITU/UTT)</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/distributor/" class="dd-item
     
      ">
        <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/distributor/">
        <span>ITU/UTT for distributører</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/kredittopplysningsforetak/" class="dd-item
     
      ">
        <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/kredittopplysningsforetak/">
        <span>ITU/UTT for kredittopplysningsforetak</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
        

        
        
            
                <li>
                    <h3>Lenker</h3>
                    <a href="https://github.com/brreg/openAPI"><i class='fa fa-fw fa-star'></i> OpenAPI specs (GitHub)</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://informasjonsforvaltning.github.io/"><i class='fa fa-fw fa-info-circle'></i> Felles datakatalog</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://altinn.github.io/docs/"><i class='fa fa-fw fa-info-circle'></i> Altinn docs</a>
                    
                </li>
            
                <li>
                    
                    <a href="/docs/credits"><i class='fa fa-fw fa-bullhorn'></i> Kred</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://github.com/brreg/docs"><i class='fa fa-fw fa-github'></i> GitHub</a>
                    
                </li>
            
           
        
        

        
    </ul>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            
              
              
              
            <div id="top-github-link">
              <a class="github-link" href="https://github.com/brreg/docs/blob/master/content/apidokumentasjon/elektronisk%20mottak/Maskinport-integrasjon/Innsending/_index.md" target="blank">
                <i class="fa fa-code-fork"></i>
                Endre
              </a>
            </div>
              
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                
                <span class="links">
                  
                  













 <a href='/docs/'>BR docs</a> > <a href='/docs/apidokumentasjon/'>API-dokumentasjon</a> > <a href='/docs/apidokumentasjon/elektronisk-mottak/'>Elektronisk mottak</a> > <a href='/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/'>Integrasjon via Maskinporten</a> > Innsending av meldinger

 

 

 

 


                </span>
            </div>
            
              <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#innledning">Innledning</a></li>
<li><a href="#sikkerhetsmekanismer">Sikkerhetsmekanismer</a></li>
<li><a href="#grensesnittbeskrivelse">Grensesnittbeskrivelse</a>
<ul>
<li><a href="#upload">Upload</a>
<ul>
<li><a href="#response">Response</a></li>
<li><a href="#feilmeldinger">Feilmeldinger</a></li>
</ul></li>
<li><a href="#eksempel-på-hvordan-opprette-httpbody-og-sende-denne-ved-bruk-av-spring-og-resttemplate">Eksempel på hvordan opprette httpbody og sende denne ved bruk av Spring og resttemplate</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>
    
            
          </div>
        
        
        <div id="body-inner">
          
            
              <h1>Innsending av meldinger</h1>
            
          






<h2 id="innledning">Innledning</h2>

<p>Maskinport-integrasjonen er en maskin-til-maskin tjeneste (API) som kan benyttes av eksterne parter for innsending av meldinger til Brønnøysundregistrene.</p>

<p>API&rsquo;et er utviklet i java og spring boot, men dette skal ikke legge føringer for klienter som tar api&rsquo;et i bruk.</p>

<h2 id="sikkerhetsmekanismer">Sikkerhetsmekanismer</h2>

<p>Siden dette er begrensede API-er så skal kallende parter autentiseres gjennom <a href="https://difi.github.io/idporten-oidc-dokumentasjon/oidc_guide_maskinporten.html">Maskinporten</a>.</p>

<p>Maskinporten utsteder JWT tokens, dette skal følge med forespørselen. Tjenestens scope er &ldquo;brreg:mottak&rdquo;. Access tokenet oppgis i Authorization headeren.</p>

<p>Husk &lsquo;Bearer &rsquo; før tokenet.</p>

<table>
<thead>
<tr>
<th>Header</th>
<th>Verdi</th>
</tr>
</thead>

<tbody>
<tr>
<td>Authorization</td>
<td>Bearer eyJraWQiOiJjWmswME1rbTVIQzRnN3Z0NmNwUDVGSFpMS0pzdzhmQkFJdUZi&hellip; (forkortet)</td>
</tr>
</tbody>
</table>

<h2 id="grensesnittbeskrivelse">Grensesnittbeskrivelse</h2>

<p>Tjenesten benytter seg av standard HTTP GET og POST.
Følgende funksjonalitet tilbys for eksterne systemer/brukere:</p>

<table>
<thead>
<tr>
<th align="left">HTTP-metode</th>
<th align="left">URL</th>
<th align="left">Beskrivelse</th>
<th align="left">Sikret med jwt</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">POST</td>
<td align="left">https://&lt;domain&gt;/upload</td>
<td align="left">Sender inn melding med 0 eller flere vedlegg</td>
<td align="left">JA</td>
</tr>

<tr>
<td align="left">GET</td>
<td align="left">https://&lt;domain&gt;/swagger-ui.html#/</td>
<td align="left">Swagger dokumentasjon</td>
<td align="left">NEI</td>
</tr>
</tbody>
</table>

<h3 id="upload">Upload</h3>

<p>Endepunktet <em>/upload</em> tar i mot <strong>POST</strong> multipart-requester med følgende deler:</p>

<table>
<thead>
<tr>
<th>Felt</th>
<th>Type</th>
<th>Innhold</th>
<th>Påkrevd</th>
</tr>
</thead>

<tbody>
<tr>
<td>Authorization</td>
<td>Header</td>
<td>Jwt access token</td>
<td>Ja</td>
</tr>

<tr>
<td>payload</td>
<td>form-data</td>
<td>xml i henhold til Melding (<a href="http://schema.brreg.no/postmottak/melding.xsd">http://schema.brreg.no/postmottak/melding.xsd</a>)</td>
<td>Ja</td>
</tr>

<tr>
<td>attachments</td>
<td>multipart-file</td>
<td>fil/bytestream</td>
<td>Nei</td>
</tr>
</tbody>
</table>

<p>Denne forespørselen laster opp en melding med ingen eller flere vedlegg/attachments.</p>

<h4 id="response">Response</h4>

<p>Ved 200 OK:</p>

<pre><code class="language-json">{
  &quot;mottakId&quot;: &quot;36b5516f-ecd4-4948-9586-42f4b7d3198a&quot;,
  &quot;mottattTidspunkt&quot;: &quot;2019-09-02T13:18:40.785&quot;,
  &quot;antallVedlegg&quot;: 2
}
</code></pre>

<h4 id="feilmeldinger">Feilmeldinger</h4>

<table>
<thead>
<tr>
<th align="left">HTTP-kode</th>
<th align="left">Applikasjonsfeilkode</th>
<th align="left">Feilmelding</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">500 Internal Server Error</td>
<td align="left">ERROR-00000</td>
<td align="left">Generisk feilhåndterer.</td>
</tr>

<tr>
<td align="left">500 Internal Server Error</td>
<td align="left">ERROR-00001</td>
<td align="left">Melding kunne ikke behandles, kunne ikke sende event til Kafka</td>
</tr>

<tr>
<td align="left">500 Internal Server Error</td>
<td align="left">ERROR-00002</td>
<td align="left">Melding kunne ikke behandles, feilet i zip-håndtering</td>
</tr>

<tr>
<td align="left">400 Bad Request</td>
<td align="left">ERROR-00003</td>
<td align="left">Melding kunne ikke behandles, feilet i XML-validering</td>
</tr>

<tr>
<td align="left">400 Bad Request</td>
<td align="left">ERROR-00004</td>
<td align="left">Mangler med request (f.eks. manglende payload)</td>
</tr>
</tbody>
</table>

<p>Disse kommer på jsonformatet:</p>

<pre><code class="language-json">{
  &quot;feilId&quot;:&quot;72577aa8-0ba1-4424-a310-fd9671547953&quot;,
  &quot;mottakId&quot;:&quot;fe7234ec-b51f-47d1-a414-5b17123118b3&quot;,
  &quot;kilde&quot;:&quot;maskinport-agent&quot;,
  &quot;feilkode&quot;:&quot;ERROR-00003&quot;,
  &quot;beskrivelse&quot;:&quot;Message invalid according to schema&quot;}
</code></pre>

<p><strong>I tillegg kommer 401 - Unauthorized ved mangler på Bearer token.</strong></p>

<table>
<thead>
<tr>
<th align="left">HTTP-kode</th>
<th align="left">header</th>
<th align="left">Header-value</th>
<th align="left">Forklaring</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">401 - Unauthorized</td>
<td align="left">WWW-Authenticate</td>
<td align="left">Bearer realm=&ldquo;unspecified&rdquo;, error=&ldquo;unauthorized&rdquo;, error_description=&ldquo;Full authentication is required to access this resource&rdquo;</td>
<td align="left">JWT access token ikke oppgitt i Authorization header i request.</td>
</tr>

<tr>
<td align="left">401 - Unauthorized</td>
<td align="left">WWW-Authenticate</td>
<td align="left">Bearer realm=&ldquo;unspecified&rdquo;, error=&ldquo;invalid_token&rdquo;, error_description=&ldquo;invalid bearer token or wrong scope for bearer token&rdquo;</td>
<td align="left">JWT access token er oppgitt, men det er enten ugyldig (utgått, korrupt eller gjeldende for et annet scope en tjenesten krever).</td>
</tr>
</tbody>
</table>

<h3 id="eksempel-på-hvordan-opprette-httpbody-og-sende-denne-ved-bruk-av-spring-og-resttemplate">Eksempel på hvordan opprette httpbody og sende denne ved bruk av Spring og resttemplate</h3>

<p><strong>Opprett httpEntity</strong></p>

<pre><code class="language-java">

        MultiValueMap&lt;String, Object&gt; body = new LinkedMultiValueMap&lt;&gt;();
        
        MultiValueMap&lt;String, String&gt; fileMap = new LinkedMultiValueMap&lt;&gt;();

        fileMap.add(HttpHeaders.CONTENT_DISPOSITION, ContentDisposition.builder(&quot;form-data&quot;)
                .name(&quot;attachments&quot;)
                .filename(&quot;filnavn.zip&quot;)
                .build().toString());
        HttpEntity&lt;byte[]&gt; fileEntity = new HttpEntity&lt;&gt;(&quot;filecontent&quot;.getBytes(), fileMap);
        
        body.add(&quot;attachments&quot;, fileEntity);
        body.add(&quot;payload&quot;, new HttpEntity&lt;String&gt;(konvolutt));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        String token = bearerTokenProvider.getToken(scope); // provides Maskinporten JWT accesstoken
        if (token != null) {
            headers.add(&quot;Authorization&quot;, &quot;Bearer &quot; + token);
        }

        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt;  requestEntity =  HttpEntity&lt;&gt;(body, headers);
</code></pre>

<p><strong>Send httpEntity</strong></p>

<pre><code class="language-java">        ResponseEntity&lt;String&gt; objectResponseEntity = restTemplate.exchange(&quot;http://maskinportagent/mottak&quot;, HttpMethod.POST, requestEntity, String.class);
</code></pre>


<footer class=" footline" >
	
</footer>





      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/" title="Integrasjon via Maskinporten"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/uthenting/" title="Uthenting av meldinger" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs/js/clipboard.min.js"></script>
    <script src="/docs/js/featherlight.min.js"></script>
    <script src="/docs/js/html5shiv-printshiv.min.js"></script>
    <script src="/docs/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs/js/modernizr.custom.71422.js"></script>
    <script src="/docs/js/learn.js"></script>
    <script src="/docs/js/hugo-learn.js"></script>

    
    <link href="/docs/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/docs/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>
