<!DOCTYPE html>
<html lang="nb" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="description" content="Veiledning for integrasjon mot maskinporten">


    
    <title>Veiledning for integrasjon mot maskinporten :: BR dokumentasjon</title>
    
    <link rel="shortcut icon" href="/docs/images/favicon.png" type="image/x-icon" />
    <link href="/docs/css/nucleus.css" rel="stylesheet">
    <link href="/docs/css/font-awesome.min.css" rel="stylesheet">
    <link href="/docs/css/hybrid.css" rel="stylesheet">
    <link href="/docs/css/featherlight.min.css" rel="stylesheet">
    <link href="/docs/css/horsey.css" rel="stylesheet">
    
    <link href="/docs/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/docs/css/bootstrap.min.css">
    <script src="/docs/js/jquery-2.x.min.js"></script>
    <style>
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    
<link href="/docs/css/altinn.css" rel="stylesheet">






  </head>
  <body class="" data-url="/docs/apidokumentasjon/losoreregisteret/itu-utt/mp-integrasjonsveiledning/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
       
	<p><a href="/docs" title="BR docs"><img src="/docs/images/brreg_logo_hvit.png" alt="BR" /> docs</a></p>
 


    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Søk...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script src="/docs/js/lunr.min.js"></script>
<script src="/docs/js/horsey.js"></script>
<script>
    var baseurl = "https:\/\/brreg.github.io\/docs\/";
</script>
<script src="/docs/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
        
        
          
          


 
  
    
    <li data-nav-id="/docs/generelt/" class="dd-item 
        
        
        parent
        ">
      <a href="/docs/generelt/">
        <span>Generelt</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/om-dokumentasjonen/" class="dd-item
     
      ">
        <a href="/docs/generelt/om-dokumentasjonen/">
        <span>Om dokumentasjonen</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/kontakt-oss/" class="dd-item
     
      ">
        <a href="/docs/generelt/kontakt-oss/">
        <span>Kontakt oss</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/eksternt-testmiljo/" class="dd-item
     
      ">
        <a href="/docs/generelt/eksternt-testmiljo/">
        <span>Eksternt testmiljø</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/generelt/tilgangsstyring/" class="dd-item
     
      ">
        <a href="/docs/generelt/tilgangsstyring/">
        <span>Tilgangsstyring</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/" class="dd-item 
        parent
        
        parent
        ">
      <a href="/docs/apidokumentasjon/">
        <span>API-dokumentasjon</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/">
        <span>Elektronisk mottak</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/">
        <span>Integrasjon direkte mot BR</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/innsending/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/innsending/">
        <span>Innsending av meldinger</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/uthenting/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/maskinport-integrasjon/uthenting/">
        <span>Uthenting av meldinger</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/elektronisk-mottak/altinn-integrasjon/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/elektronisk-mottak/altinn-integrasjon/">
        <span>Integrasjon via Altinn</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/enhetsregisteret/" class="dd-item 
        
        
        
        ">
      <a href="/docs/apidokumentasjon/enhetsregisteret/">
        <span>Enhetsregisteret</span>

        
        

        
      </a>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/" class="dd-item 
        parent
        
        
        ">
      <a href="/docs/apidokumentasjon/losoreregisteret/">
        <span>Løsøreregisteret</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/" class="dd-item 
        parent
        
        
        ">
      <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/">
        <span>Intet til utlegg/utleggstrekk (ITU/UTT)</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/distributor/" class="dd-item
     
      ">
        <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/distributor/">
        <span>ITU/UTT for distributører</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/kredittopplysningsforetak/" class="dd-item
     
      ">
        <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/kredittopplysningsforetak/">
        <span>ITU/UTT for kredittopplysningsforetak</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/apidokumentasjon/losoreregisteret/itu-utt/mp-integrasjonsveiledning/" class="dd-item
     active
      ">
        <a href="/docs/apidokumentasjon/losoreregisteret/itu-utt/mp-integrasjonsveiledning/">
        <span>Veiledning for integrasjon mot maskinporten</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
        

        
        
            
                <li>
                    <h3>Lenker</h3>
                    <a href="https://github.com/brreg/openAPI"><i class='fa fa-fw fa-star'></i> OpenAPI specs (GitHub)</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://informasjonsforvaltning.github.io/"><i class='fa fa-fw fa-info-circle'></i> Felles datakatalog</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://altinn.github.io/docs/"><i class='fa fa-fw fa-info-circle'></i> Altinn docs</a>
                    
                </li>
            
                <li>
                    
                    <a href="/docs/credits"><i class='fa fa-fw fa-bullhorn'></i> Kred</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://github.com/brreg/docs"><i class='fa fa-fw fa-github'></i> GitHub</a>
                    
                </li>
            
           
        
        

        
    </ul>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            
              
              
              
            <div id="top-github-link">
              <a class="github-link" href="https://github.com/brreg/docs/blob/master/content/apidokumentasjon/losoreregisteret/itu-utt/mp-integrasjonsveiledning.md" target="blank">
                <i class="fa fa-code-fork"></i>
                Endre
              </a>
            </div>
              
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                
                <span class="links">
                  
                  













 <a href='/docs/'>BR docs</a> > <a href='/docs/apidokumentasjon/'>API-dokumentasjon</a> > <a href='/docs/apidokumentasjon/losoreregisteret/'>Løsøreregisteret</a> > <a href='/docs/apidokumentasjon/losoreregisteret/itu-utt/'>Intet til utlegg/utleggstrekk (ITU/UTT)</a> > Veiledning for integrasjon mot maskinporten

 

 

 

 


                </span>
            </div>
            
              <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#innledning">Innledning</a></li>
<li><a href="#registrering-av-klient">Registrering av klient</a>
<ul>
<li><a href="#lag-keystore">Lag Keystore</a></li>
<li><a href="#jwt-grant-generator">JWT-grant-generator</a></li>
<li><a href="#generere-jwt">Generere JWT</a></li>
<li><a href="#registrer-klient">Registrer klient</a></li>
</ul></li>
<li><a href="#uthenting-av-token">Uthenting av token</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>
    
            
          </div>
        
        
        <div id="body-inner">
          
            
              <h1>Veiledning for integrasjon mot maskinporten</h1>
            
          






<h2 id="innledning">Innledning</h2>

<p>For å kunne få tilgang til BRSys systemene kreves autentisering via <a href="https://difi.github.io/idporten-oidc-dokumentasjon/oidc_guide_maskinporten.html">Maskinporten</a>.
Denne siden er ment til å være en veiledning som gir et eksempel på hvordan gå frem for å få integreringen med maskinporten.</p>

<p>Veiledningen er laget for integrasjon mot BRSys og Maskinporten sitt testmiljø. Ved integrasjon mot prod, erstatt maskinport-spesifikke URLer med tilsvarende for prod.
Se <a href="https://difi.github.io/felleslosninger/maskinporten_func_wellknown.html">oversikten</a> for endepunkter hos maskinporten.</p>

<p>I produksjonsmiljø vil en også kunne registrere klienter manuelt i selvbetjeningsportalen til maskinporten.</p>

<h2 id="registrering-av-klient">Registrering av klient</h2>

<p><strong><em>INFO</em></strong> Før en begynner å opprette integrasjonen må en ha et gyldig virksomhetssertifikat, enten for et syntetisk organisasjonsnummr (testmiljø), eller for et gyldig organisasjonsnummer (produksjonsmiljø)</p>

<h3 id="lag-keystore">Lag Keystore</h3>

<p>En keystore av typen JKS som inneholder virksomhetssertifikatet må opprettes, se <a href="https://difi.github.io/felleslosninger/oidc_sample_jwtgrant_postman.html">Maskinporten</a> for nærmere informasjon</p>

<p>Dette kan gjøres i UNIX-systemer (Mac/Linux) ved å kjøre kommandoen:</p>

<pre><code>keytool -v -importkeystore -srckeystore &lt;filnavn&gt; -srcstoretype PKCS12 (om virksomhetssertifikatet er av type .p12) -destkeystore &lt;ønsket-navn-på-keystore&gt; -deststoretype JKS
</code></pre>

<p>Etter input vil du først lage et passord for keystore, dette trenger du videre. Deretter blir en spurt om passordet til virksomhetssertifikatet. Skriv inn ønsket og gitt passord og keystore vil bli opprettet.</p>

<h3 id="jwt-grant-generator">JWT-grant-generator</h3>

<p>Autentisering via maskinporten foregår ved hjelp av JWT tokens. Difi har laget en egen <a href="https://github.com/difi/jwt-grant-generator">JWT-grant-generator</a> som lastes ned og bygges i henhold til dokumentasjonen som finnes på lenken.</p>

<h3 id="generere-jwt">Generere JWT</h3>

<p>For førstegangsregistrering kreves en properties fil når du lager JWT-en med disse parametrene:</p>

<pre><code class="language-json">issuer=oidc_(orgnr)_api
audience=https://oidc-ver2.difi.no/idporten-oidc-provider/
scope=idporten:dcr.write idporten:dcr.read
token.endpoint=https://oidc-ver2.difi.no/idporten-oidc-provider/token
</code></pre>

<p>I tillegg kommer <a href="https://github.com/difi/jwt-grant-generator">keystore spesifikke properties, som er beskrevet her</a></p>

<p>Når properties filen er ferdig laget, kan en følge retningslinjene nederst i lenken over for å genere en JWT og få ut access_token fra maskinporten.
Dette access tokenet blir brukt for å registrere en vedvarende klient hos maskinporten.</p>

<h3 id="registrer-klient">Registrer klient</h3>

<p>Send en POST-request til <a href="https://integrasjon-ver2.difi.no/clients/">https://integrasjon-ver2.difi.no/clients/</a> for å registrere ny klient,
se <a href="https://difi.github.io/felleslosninger/maskinporten_guide_apikonsument.html#registrere-klient-som-bruker-virksomhetssertifikat">maskinporten</a>.
Bruk access token fra forrige steg. Klienten skal registreres for scope &ldquo;brreg:losore/utlegg&rdquo;. Maskinporten vil svare med en client_id.</p>

<h2 id="uthenting-av-token">Uthenting av token</h2>

<p><strong><em>INFO</em></strong> Dette steget forutsetter at en klient allerede er opprettet</p>

<p>Opprett en properties fil med felter som beskrevet <a href="https://difi.github.io/felleslosninger/maskinporten_guide_apikonsument.html#5-be-om-token">her</a></p>

<p>Flere av feltene vil JWT-grant-generator skape automatisk om denne brukes. Ved bruk av JWT-grant-generator, opprett en properties fil med feltene beskrevet i seksjonen for å generere JWT,
med følgende endringer:</p>

<pre><code class="language-json">issuer=klient_id  
scope=brreg:losore/utlegg
</code></pre>

<p>Ved kjøring av JWT-grant-generatoren vil en få ut et access token som kan brukes mot våre APIer.</p>


<footer class=" footline" >
	
</footer>



      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/docs/apidokumentasjon/losoreregisteret/itu-utt/kredittopplysningsforetak/" title="ITU/UTT for kredittopplysningsforetak"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/docs/apidokumentasjon/losoreregisteret/itu-utt/distributor/" title="ITU/UTT for distributører" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs/js/clipboard.min.js"></script>
    <script src="/docs/js/featherlight.min.js"></script>
    <script src="/docs/js/html5shiv-printshiv.min.js"></script>
    <script src="/docs/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs/js/modernizr.custom.71422.js"></script>
    <script src="/docs/js/learn.js"></script>
    <script src="/docs/js/hugo-learn.js"></script>

    
    <link href="/docs/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/docs/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>

